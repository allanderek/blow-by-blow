{% extends "base.html" %}
{% block content %}
<h1>{{db_feed.id}}</h1>


{% if secret is not none %}
    <div id="commentate-area">
        <form id="make-comment"
              method="POST"
              action="{{ url_for('commentate_on_feed', feed_no=db_feed.id,
                                 secret=secret) }}">
                {{ commentate_form.hidden_tag() }}
                {{ commentate_form.comment_text.label }}
                {{ commentate_form.comment_text() }}
                <button type="submit"
                        class="commentate_button"
                        name="commentate_button">Update</button>
            </form>
    </div>
{% endif %}


<ul id="feed-moment-list">
    {% for moment in db_feed.moments %}
        <li>{{moment.content}}</li>
    {% endfor %}
</ul>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
    function sse() {
        var source = new EventSource('/stream/{{db_feed.id}}');
        var out = document.getElementById('feed-moment-list');
        source.onmessage = function(e) {
            // XSS in chat is fun
            var li = document.createElement('li');
            out.appendChild(li);
            li.innerHTML = e.data;

        };
    }
    sse();

    /* At some point we might wish to post to a feed without leaving
    the feed page. In this case we want code similar to the below,
    although of course the post will have to send the feed id and author
    secret, and additionally it is not the '#in' element.
    $('#in').keyup(function(e){
        if (e.keyCode == 13) {
            $.post('/post', {'message': $(this).val()});
            $(this).val('');
        }
    });
    */
</script>


{% endblock %}
