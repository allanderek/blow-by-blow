{% extends "base.html" %}
{% block content %}
<h1>Describe Your Event</h1>

<div id="commentate-area">
    <form id="make-comment"
          method="POST"
          action="{{ url_for('commentate_on_feed', feed_no=feed_no,
                             secret=secret) }}">
            {{ commentate_form.hidden_tag() }}
            {{ commentate_form.comment_text.label }}
            {{ commentate_form.comment_text() }}
            <button type="submit"
                    class="commentate_button"
                    name="commentate_button">Update</button>
        </form>
</div>

<pre id="out"></pre>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
    function sse() {
        var source = new EventSource('/stream');
        var out = document.getElementById('out');
        source.onmessage = function(e) {
            // XSS in chat is fun
            out.innerHTML =  e.data + '\\n' + out.innerHTML;
        };
    }
    $('#in').keyup(function(e){
        if (e.keyCode == 13) {
            $.post('/post', {'message': $(this).val()});
            $(this).val('');
        }
    });
    sse();
</script>


{% endblock %}
